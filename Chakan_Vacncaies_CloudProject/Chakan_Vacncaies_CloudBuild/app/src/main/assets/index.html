<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chakan Vacancies Portal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f0f4f8; 
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
        }
        
        /* Hide scrollbar for clean UI */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

        .tab-content { display: none; opacity: 0; transform: translateY(10px); transition: all 0.3s ease-out; }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }
        
        /* Modal Styles with Blur */
        .modal {
            position: fixed; inset: 0; z-index: 50; display: flex; align-items: center; justify-content: center;
            background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); opacity: 0; visibility: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .modal.open { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: white; padding: 2rem; border-radius: 1.5rem; width: 90%; max-width: 550px;
            max-height: 85vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .modal.open .modal-content { transform: scale(1); }
        
        /* Glassmorphism Bottom Nav */
        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-top: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }

        /* Active Tab Styling */
        .nav-item { position: relative; transition: all 0.3s ease; }
        .nav-item.active .icon-container {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 8px 16px -4px rgba(249, 115, 22, 0.5);
        }
        .nav-item.active span { color: #ea580c; font-weight: 700; }
        .icon-container {
            width: 44px; height: 44px; border-radius: 14px;
            display: flex; align-items: center; justify-content: center;
            background-color: transparent; color: #64748b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Job Card Styling */
        .job-card { 
            background: white; border-radius: 16px; 
            border: 1px solid #f1f5f9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
        }
        .job-card:active { transform: scale(0.98); }
        .job-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: linear-gradient(to bottom, #f97316, #fb923c); opacity: 0; transition: opacity 0.3s;
        }
        .job-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); border-color: #fdba74; }
        .job-card:hover::before { opacity: 1; }

        /* Splash Screen */
        #splashScreen {
            position: fixed; inset: 0; z-index: 200; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #fff7ed 0%, #fff 100%);
            transition: opacity 0.6s ease-out, visibility 0.6s;
        }
        #splashScreen.hide-splash { opacity: 0; visibility: hidden; pointer-events: none; }
        
        .logo-loader-container { position: relative; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
        .loading-ring { position: absolute; inset: 0; border-radius: 50%; border: 4px solid transparent; border-top-color: #f97316; border-right-color: #fb923c; border-bottom-color: rgba(249, 115, 22, 0.1); border-left-color: rgba(249, 115, 22, 0.1); animation: ringSpin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; }
        .splash-logo { width: 90px; height: 90px; z-index: 2; background: white; border-radius: 24px; box-shadow: 0 10px 30px -5px rgba(249, 115, 22, 0.2); display: flex; align-items: center; justify-content: center; padding: 1rem; animation: logoPulse 3s ease-in-out infinite; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes ringSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes logoPulse { 0%, 100% { transform: scale(1); filter: drop-shadow(0 4px 6px rgba(249, 115, 22, 0.2)); } 50% { transform: scale(1.05); filter: drop-shadow(0 8px 12px rgba(249, 115, 22, 0.4)); } }

        /* Custom Inputs */
        .input-field { width: 100%; padding: 0.875rem 1rem; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 0.95rem; color: #334155; transition: all 0.2s; }
        .input-field:focus { background-color: white; border-color: #f97316; box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1); outline: none; }

        .btn-primary { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; font-weight: 600; padding: 0.875rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.3); transition: all 0.2s; border: none; width: 100%; }
        .btn-primary:active { transform: scale(0.97); box-shadow: none; }
        
        .rotate-anim { animation: spin 0.5s ease-in-out; }
        #otpNotification { position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-20px); opacity: 0; background: white; border-left: 4px solid #16a34a; color: #1e293b; padding: 16px 24px; border-radius: 12px; z-index: 150; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); font-weight: 600; display: flex; align-items: center; gap: 12px; pointer-events: none; }
        #otpNotification.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        .checkmark-wrapper { display: flex; justify-content: center; align-items: center; margin-bottom: 1rem; }
        .checkmark { width: 56px; height: 56px; border-radius: 50%; display: block; stroke-width: 2; stroke: #fff; stroke-miterlimit: 10; box-shadow: inset 0px 0px 0px #16a34a; animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both; }
        .checkmark__circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: #16a34a; fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark__check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 30px #16a34a; } }
        
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #f97316; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Language Toggle Button Style */
        .lang-btn {
            padding: 0.5rem 1rem; border-radius: 999px; font-weight: 600; font-size: 0.875rem; transition: all 0.2s; border: 1px solid #e2e8f0; color: #64748b;
        }
        .lang-btn.active {
            background-color: #f97316; color: white; border-color: #f97316;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-800">

    <!-- 1. SPLASH SCREEN -->
    <div id="splashScreen">
        <div class="logo-loader-container">
            <div class="loading-ring"></div>
            <div class="splash-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="url(#logoGradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f97316;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ea580c;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
        </div>
        <h1 class="app-name-splash text-2xl font-bold text-slate-800 tracking-tight mt-4">Chakan Vacancies</h1>
        <p class="text-orange-500 text-xs font-semibold tracking-wide mt-1 text-center px-4">Jobs available in Chakan, Khed City, Ranjangaon & Bhosari</p>
    </div>

    <!-- OTP NOTIFICATION -->
    <div id="otpNotification">
        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span>OTP sent to your email address</span>
    </div>

    <!-- INFO MODAL (First Time User) -->
    <div id="infoModal" class="modal">
        <div class="modal-content relative p-0 overflow-hidden">
            <div class="bg-orange-50 p-6 border-b border-orange-100 text-center">
                <h2 id="infoTitle" class="text-xl font-bold text-slate-900">Application Information</h2>
                <div class="flex justify-center gap-2 mt-4">
                    <button onclick="changeInfoLanguage('en')" class="lang-btn active" id="langEn">English</button>
                    <button onclick="changeInfoLanguage('hi')" class="lang-btn" id="langHi">Hindi</button>
                    <button onclick="changeInfoLanguage('mr')" class="lang-btn" id="langMr">Marathi</button>
                </div>
            </div>
            <div class="p-6 max-h-[60vh] overflow-y-auto space-y-6">
                <!-- Content injected via JS -->
                <div id="infoContent"></div>
            </div>
            <div class="p-4 border-t border-slate-100 flex justify-center">
                <button onclick="closeInfoModal()" class="btn-primary w-auto px-8">Continue to App</button>
            </div>
        </div>
    </div>

    <!-- LOGIN / REGISTER OVERLAY -->
    <div id="authOverlay" class="fixed inset-0 bg-white/95 backdrop-blur-md z-[100] flex flex-col items-center justify-center p-6 hidden">
        <div class="w-full max-w-sm animate-[fadeIn_0.5s_ease-out] relative">
            <button onclick="toggleAuthOverlay(false)" class="absolute -top-12 right-0 p-2 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Chakan Vacancies</h1>
                <p class="text-gray-500 mt-2">Login to apply for jobs.</p>
            </div>
            <div class="flex bg-gray-100 p-1 rounded-lg mb-6">
                <button onclick="switchAuthRole('Candidate')" id="btnRoleCandidate" class="flex-1 py-2.5 text-sm font-semibold rounded-xl bg-white text-slate-900 shadow-sm transition-all">Candidate</button>
                <button onclick="switchAuthRole('Recruiter')" id="btnRoleRecruiter" class="flex-1 py-2.5 text-sm font-semibold rounded-xl text-slate-500 hover:text-slate-900 transition-all">Recruiter</button>
                <button onclick="switchAuthRole('Admin')" id="btnRoleAdmin" class="flex-1 py-2.5 text-sm font-semibold rounded-xl text-slate-500 hover:text-slate-900 transition-all">Admin</button>
            </div>
            <div id="authForms">
                <form id="loginForm" class="space-y-5">
                    <div><label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5">Email Address</label><input type="email" id="loginEmail" required class="input-field" placeholder="name@example.com"></div>
                    <div id="otpField" class="hidden animate-fade-in"><label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5">Enter OTP</label><input type="text" id="loginOtp" class="input-field text-center tracking-[0.5em] font-bold text-lg" placeholder="••••" maxlength="4"></div>
                    <button type="submit" id="btnLogin" class="btn-primary mt-4">Get OTP</button>
                </form>
                <div class="mt-6"><button onclick="toggleRegistration(true)" class="w-full py-3.5 border-2 border-orange-100 text-orange-600 font-bold rounded-xl hover:bg-orange-50 transition-all text-sm uppercase tracking-wide">Register New Account</button></div>
            </div>
            <form id="registerForm" class="space-y-4 hidden">
                <h3 class="text-xl font-bold text-slate-900 mb-6">Create Account</h3>
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="regName" placeholder="Full Name" required class="input-field">
                    <input type="email" id="regEmail" placeholder="Email Address" required class="input-field">
                    <input type="tel" id="regMobile" placeholder="Mobile" required class="input-field">
                    <input type="number" id="regAge" placeholder="Age" class="input-field">
                </div>
                <div id="candidateFields" class="space-y-4">
                    <input type="text" id="regLocation" placeholder="Current Location" class="input-field">
                    <input type="text" id="regSkills" placeholder="Skills (e.g. Java, Sales)" class="input-field">
                    <input type="text" id="regQualification" placeholder="Qualification" class="input-field">
                </div>
                <button type="submit" class="btn-primary mt-6 py-4 text-lg shadow-xl w-full">Register</button>
                <div class="text-center mt-4"><a href="#" onclick="toggleRegistration(false)" class="text-sm font-semibold text-slate-500 hover:text-slate-800">Back to Login</a></div>
            </form>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-30 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex flex-col justify-center">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center text-white shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
                        </div>
                        <span class="text-lg font-bold text-slate-800 tracking-tight">Chakan<span class="text-orange-600">Jobs</span></span>
                    </div>
                    <span class="text-[10px] text-slate-500 font-medium mt-0.5 ml-10 hidden sm:block">Jobs available in Chakan, Khed City, Ranjangaon & Bhosari</span>
                </div>
                <div class="flex items-center gap-3">
                    <span id="userGreeting" class="text-sm font-medium text-slate-500 hidden sm:block bg-slate-100 px-3 py-1 rounded-full">Guest</span>
                    <button id="headerLogoutBtn" onclick="handleLogout()" class="p-2 rounded-full bg-slate-50 text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- CONTENT -->
    <main class="flex-1 overflow-y-auto pb-24 p-4 max-w-7xl mx-auto w-full">
        <!-- Jobs Tab -->
        <div id="tabJobs" class="tab-content active">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <h2 id="jobsTitle" class="text-2xl font-bold text-slate-800">Latest Jobs</h2>
                    <button onclick="animateRefresh('btnRefreshJobs'); loadJobs()" id="btnRefreshJobs" class="p-2 text-slate-400 hover:text-orange-500 hover:bg-orange-50 rounded-full transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    </button>
                </div>
                <button id="postJobBtn" onclick="openPostJobModal()" class="hidden btn-primary w-auto px-4 py-2 text-sm shadow-lg shadow-orange-200">+ Post Job</button>
            </div>
            <div id="jobFeed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"><div class="text-center py-20 text-slate-400 col-span-full flex flex-col items-center"><div class="spinner mb-4"></div><p>Fetching opportunities...</p></div></div>
        </div>

        <!-- Apps Tab -->
        <div id="tabApplications" class="tab-content">
            <div class="flex items-center gap-3 mb-6"><h2 class="text-2xl font-bold text-slate-800">Applications</h2><button onclick="animateRefresh('btnRefreshApps'); loadApplications()" id="btnRefreshApps" class="p-2 text-slate-400 hover:text-orange-500 hover:bg-orange-50 rounded-full transition-all"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg></button></div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"><div class="overflow-x-auto"><table class="min-w-full divide-y divide-slate-100"><thead class="bg-slate-50/50"><tr><th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Job</th><th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Candidate</th><th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Contact</th><th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Details</th><th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">Status</th></tr></thead><tbody id="applicationsTable" class="bg-white divide-y divide-slate-50"></tbody></table></div></div>
        </div>

        <!-- Admin Tab -->
        <div id="tabAdmin" class="tab-content">
            <div class="flex items-center gap-3 mb-6"><h2 class="text-2xl font-bold text-slate-800">Admin</h2><button onclick="animateRefresh('btnRefreshAdmin'); loadAdminData()" id="btnRefreshAdmin" class="p-2 text-slate-400 hover:text-orange-500 hover:bg-orange-50 rounded-full transition-all"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg></button></div>
            <div class="grid grid-cols-2 gap-4 mb-8"><div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100"><p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Active Jobs</p><p class="text-3xl font-bold text-orange-500" id="statActiveJobs">0</p></div><div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100"><p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Recruiters</p><p class="text-3xl font-bold text-blue-500" id="statRecruiters">0</p></div></div>
            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3">Pending Recruiter Approvals</h3><div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-8"><ul id="pendingRecruitersList" class="divide-y divide-slate-50"><li class="p-6 text-center text-slate-400 text-sm">Loading...</li></ul></div>
            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3">Pending Job Approvals</h3><div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"><ul id="pendingJobsList" class="divide-y divide-slate-50"><li class="p-6 text-center text-slate-400 text-sm">Loading...</li></ul></div>
        </div>

        <!-- Profile Tab -->
        <div id="tabProfile" class="tab-content">
            <div class="flex items-center gap-3 mb-6">
                <h2 class="text-2xl font-bold text-slate-800">My Profile</h2>
                <button onclick="animateRefresh('btnRefreshProfile'); loadProfile()" id="btnRefreshProfile" class="p-2 text-slate-400 hover:text-orange-500 hover:bg-orange-50 rounded-full transition-all"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg></button>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                <div class="flex items-center space-x-5 mb-8">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-orange-100 to-orange-50 flex items-center justify-center text-orange-600 text-3xl font-bold shadow-inner" id="profileInitials">U</div>
                    <div>
                        <h3 class="text-2xl font-bold text-slate-900" id="profileName">User Name</h3>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="px-2.5 py-0.5 rounded-full bg-slate-100 text-slate-600 text-xs font-semibold" id="profileRole">Role</span>
                            <span class="px-2.5 py-0.5 rounded-full text-xs font-semibold" id="profileStatus">--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Language Selector inside Profile -->
                <div class="mb-6 p-4 bg-slate-50 rounded-xl border border-slate-100">
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-3">Language / भाषा</p>
                    <select id="profileLangSelect" onchange="changeAppLanguage(this.value)" class="w-full p-2 rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-700 focus:ring-2 focus:ring-orange-500 outline-none">
                        <option value="en">English</option>
                        <option value="hi">Hindi (हिंदी)</option>
                        <option value="mr">Marathi (मराठी)</option>
                    </select>
                </div>

                <div class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-50 rounded-xl border border-slate-100"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Email</span><span class="font-medium text-slate-700 break-all" id="profileEmail">--</span></div>
                        <div class="p-4 bg-slate-50 rounded-xl border border-slate-100"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Mobile</span><span class="font-medium text-slate-700" id="profileMobile">--</span></div>
                    </div>
                    <div id="profileCandidateDetails" class="hidden">
                        <h4 class="text-sm font-bold text-slate-800 mb-3 border-b border-slate-100 pb-2">Professional Info</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="p-4 bg-slate-50 rounded-xl border border-slate-100"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Skills</span><span class="font-medium text-slate-700" id="profileSkills">--</span></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 bg-slate-50 rounded-xl border border-slate-100"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Qualification</span><span class="font-medium text-slate-700" id="profileQual">--</span></div>
                                <div class="p-4 bg-slate-50 rounded-xl border border-slate-100"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-1">Location</span><span class="font-medium text-slate-700" id="profileLoc">--</span></div>
                            </div>
                        </div>
                    </div>
                    <button onclick="handleLogout()" class="w-full mt-4 py-3 px-4 border border-red-100 text-red-600 bg-red-50/50 rounded-xl hover:bg-red-100 hover:border-red-200 font-semibold transition-all shadow-sm">Sign Out</button>
                    <div class="mt-6 pt-6 border-t border-slate-100 flex flex-col items-center">
                        <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3">Download Our App</p>
                        <a href="#" class="flex items-center gap-3 bg-slate-900 text-white px-4 py-2.5 rounded-xl shadow-lg hover:bg-slate-800 transition-all transform hover:-translate-y-1 w-full sm:w-auto justify-center">
                            <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 3.5L19 12L5 20.5V3.5Z" fill="#fff"/></svg>
                            <div class="text-left"><div class="text-[10px] font-medium uppercase leading-none opacity-80 mb-0.5">Android App on</div><div class="text-sm font-bold leading-tight">Google Play</div></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FLOATING BOTTOM NAV -->
    <nav class="fixed bottom-0 w-full z-40 pb-safe">
        <div class="glass-nav mx-auto max-w-7xl flex justify-around items-center h-[72px] px-2">
            <button onclick="switchTab('tabJobs')" class="nav-item active flex flex-col items-center justify-center w-full h-full text-slate-400 group">
                <div class="icon-container mb-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg></div>
                <span class="text-[10px] font-medium transition-colors">Jobs</span>
            </button>
            <button onclick="switchTab('tabApplications')" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 group">
                <div class="icon-container mb-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg></div>
                <span class="text-[10px] font-medium transition-colors">Apps</span>
            </button>
            <button id="navAdmin" onclick="switchTab('tabAdmin')" class="nav-item hidden flex flex-col items-center justify-center w-full h-full text-slate-400 group">
                <div class="icon-container mb-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg></div>
                <span class="text-[10px] font-medium transition-colors">Admin</span>
            </button>
            <button id="navLogin" onclick="toggleAuthOverlay(true)" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 group">
                <div class="icon-container mb-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" /></svg></div>
                <span class="text-[10px] font-medium transition-colors">Login</span>
            </button>
            <button id="navProfile" onclick="switchTab('tabProfile')" class="nav-item hidden flex flex-col items-center justify-center w-full h-full text-slate-400 group">
                <div class="icon-container mb-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg></div>
                <span class="text-[10px] font-medium transition-colors">Profile</span>
            </button>
        </div>
    </nav>

    <!-- POST JOB MODAL -->
    <div id="postJobModal" class="modal">
        <div class="modal-content relative">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-900">Post New Job</h3>
                <button onclick="closeModal('postJobModal')" class="p-2 text-slate-400 hover:text-slate-600 bg-slate-100 rounded-full transition-colors"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>
            </div>
            <div id="postJobStatus" class="hidden flex flex-col items-center justify-center py-10 text-center"></div>
            <form id="postJobForm" class="space-y-4">
                <div><label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5">Job Title</label><input type="text" name="title" required class="input-field"></div>
                <div class="grid grid-cols-2 gap-4"><div><label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5">Company</label><input type="text" name="company" required class="input-field"></div><div><label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5">Vacancies</label><input type="number" name="vacancies" required class="input-field"></div></div>
                <div><label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5">Skills Required</label><input type="text" name="skills" placeholder="e.g. Java, Sales, Driving" required class="input-field"></div>
                <div class="grid grid-cols-2 gap-4"><input type="number" name="salaryFrom" placeholder="Min Salary" class="input-field"><input type="number" name="salaryTo" placeholder="Max Salary" class="input-field"></div>
                <div class="grid grid-cols-2 gap-4"><input type="text" name="education" placeholder="Education" required class="input-field"><input type="tel" name="contact" placeholder="Contact No" required class="input-field"></div>
                <div class="grid grid-cols-2 gap-4"><input type="text" name="location" placeholder="City/Locality" required class="input-field"><input type="text" name="state" placeholder="State" required class="input-field"></div>
                <button type="submit" class="btn-primary mt-2">Submit Job Post</button>
            </form>
        </div>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz-qoOGgsp2tc6V07PG5NOrbl7zX1nxJOZvChl_bO654Zr5VsiSlC3VEGN-kdHyoMk/exec';
        let currentUser = null; 
        let currentAuthRole = 'Candidate'; 
        let lastJobId = null;

        // --- TRANSLATIONS ---
        const TRANSLATIONS = {
            'en': { infoTitle: "Application Information", candTitle: "For Candidates", candList: ["Free job opportunities available on our app.", "100% trusted platform.", "Once you register, you will receive new job requirement notifications on your mobile."], recTitle: "For Recruiters", recList: ["If you have vacancies, you can register as a recruiter and post jobs for free.", "After posting a vacancy, it will remain pending for admin approval and will be approved within 15 minutes.", "Once a candidate applies, you can view all applications in the “Applications” tab, along with candidate contact details."] },
            'hi': { infoTitle: "एप्लिकेशन जानकारी", candTitle: "उम्मीदवारों के लिए", candList: ["हमारे ऐप पर फ्री जॉब अवसर उपलब्ध हैं।", "100% भरोसेमंद ऐप।", "रजिस्टर करने पर आपको नए जॉब रिक्वायरमेंट की नोटिफिकेशन अपने मोबाइल पर मिलती रहेंगी।"], recTitle: "रिक्रूटर्स के लिए", recList: ["यदि आपके पास वैकेंसी है, तो आप रिक्रूटर के रूप में रजिस्टर कर सकते हैं और फ्री में जॉब पोस्ट कर सकते हैं।", "जॉब पोस्ट करने के बाद वह एडमिन अप्रूवल में जाएगी और 15 मिनट के अंदर अप्रूव हो जाएगी।", "जब कोई उम्मीदवार अप्लाई करेगा, तो आपको सभी एप्लिकेशन “Applications” टैब में मिलेंगी और उम्मीदवार का संपर्क विवरण भी देख सकेंगे।"] },
            'mr': { infoTitle: "अॅप्लिकेशन माहिती", candTitle: "उमेदवारांसाठी", candList: ["आमच्या अॅपमध्ये मोफत नोकरी संधी उपलब्ध आहेत.", "100% विश्वासार्ह अॅप.", "तुम्ही एकदा नोंदणी केली की नवीन जॉब रिक्वायरमेंटची नोटिफिकेशन्स तुमच्या मोबाईलवर मिळतील."], recTitle: "भरती करणाऱ्यांसाठी", recList: ["तुमच्याकडे रिक्त पदे असल्यास, तुम्ही रिक्रुटर म्हणून नोंदणी करून मोफत जॉब पोस्ट करू शकता.", "जॉब पोस्ट केल्यानंतर ती अॅडमिन मंजुरीसाठी पेंडिंग राहील आणि 15 मिनिटांत मंजूर केली जाईल.", "उमेदवार अर्ज केल्यावर, सर्व अर्ज “Applications” टॅबमध्ये दिसतील तसेच उमेदवाराचा संपर्क तपशीलही पाहू शकता."] }
        };

        function finishLoading() {
            const splash = document.getElementById('splashScreen');
            if (splash.classList.contains('hide-splash')) return;
            splash.classList.add('hide-splash');
            initApp();
        }
        function startSplashTimer() { setTimeout(finishLoading, 3000); }
        if (document.readyState === 'complete' || document.readyState === 'interactive') { startSplashTimer(); } else { window.addEventListener('load', startSplashTimer); }
        setTimeout(finishLoading, 6000); 

        // --- LANGUAGE & MODAL ---
        function openInfoModal() {
            const currentLang = localStorage.getItem('app_language') || 'en';
            changeInfoLanguage(currentLang); document.getElementById('infoModal').classList.add('open');
        }
        function closeInfoModal() { document.getElementById('infoModal').classList.remove('open'); localStorage.setItem('is_first_open', 'false'); }
        function changeInfoLanguage(lang) {
            localStorage.setItem('app_language', lang);
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            if(lang === 'en') document.getElementById('langEn').classList.add('active'); if(lang === 'hi') document.getElementById('langHi').classList.add('active'); if(lang === 'mr') document.getElementById('langMr').classList.add('active');
            const t = TRANSLATIONS[lang]; const contentDiv = document.getElementById('infoContent'); document.getElementById('infoTitle').innerText = t.infoTitle;
            let html = `<div><h3 class="text-orange-600 font-bold text-lg mb-2">${t.candTitle}</h3><ul class="list-disc pl-5 space-y-1 text-slate-600 text-sm">${t.candList.map(item => `<li>${item}</li>`).join('')}</ul></div><div class="pt-4 border-t border-slate-100"><h3 class="text-blue-600 font-bold text-lg mb-2">${t.recTitle}</h3><ul class="list-disc pl-5 space-y-1 text-slate-600 text-sm">${t.recList.map(item => `<li>${item}</li>`).join('')}</ul></div>`;
            contentDiv.innerHTML = html;
        }
        function changeAppLanguage(lang) { localStorage.setItem('app_language', lang); }

        function switchAuthRole(role) {
            currentAuthRole = role;
            ['Candidate', 'Recruiter', 'Admin'].forEach(r => {
                const btn = document.getElementById(`btnRole${r}`);
                if(r === role) { btn.classList.add('bg-white', 'text-slate-900', 'shadow-sm'); btn.classList.remove('text-slate-500'); } 
                else { btn.classList.remove('bg-white', 'text-slate-900', 'shadow-sm'); btn.classList.add('text-slate-500'); }
            });
            document.getElementById('candidateFields').style.display = role === 'Candidate' ? 'block' : 'none';
        }

        function toggleRegistration(show) { document.getElementById('loginForm').classList.toggle('hidden', show); document.getElementById('registerForm').classList.toggle('hidden', !show); }
        function toggleAuthOverlay(show) { const overlay = document.getElementById('authOverlay'); if(show) { overlay.classList.remove('hidden'); overlay.style.display = 'flex'; } else { overlay.classList.add('hidden'); overlay.style.display = 'none'; } }

        function showOtpNotification(otp) {
            const notif = document.getElementById('otpNotification');
            notif.innerHTML = '<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span class="font-medium text-slate-700 ml-2">OTP sent to your email address</span>';
            notif.classList.add('show');
            setTimeout(() => { notif.classList.remove('show'); }, 8000);
        }
        
        async function initApp() {
            const isFirstOpen = localStorage.getItem('is_first_open');
            if (isFirstOpen === null) { if(!localStorage.getItem('app_language')) localStorage.setItem('app_language', 'en'); openInfoModal(); }
            if ("Notification" in window) { Notification.requestPermission(); }

            const savedUser = localStorage.getItem('job_portal_user');
            if (savedUser) { try { loginSuccess(JSON.parse(savedUser)); } catch(e) {} } 
            else {
                document.getElementById('navLogin').classList.remove('hidden'); document.getElementById('navProfile').classList.add('hidden'); document.getElementById('headerLogoutBtn').classList.add('hidden'); document.getElementById('userGreeting').innerText = "Guest"; loadJobs(); 
            }
            setInterval(checkNewJobs, 30000); 
        }

        async function checkNewJobs() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=get_active_jobs`); const result = await response.json();
                if(result.status === 'success' && result.data.length > 0) {
                    const latestJob = result.data[0];
                    if (lastJobId && lastJobId !== latestJob.jobId) {
                        if (Notification.permission === "granted") {
                            new Notification("New Job Alert!", {
                                body: `${latestJob.title} at ${latestJob.company}`,
                                icon: "https://cdn-icons-png.flaticon.com/512/3850/3850285.png" 
                            });
                        }
                        if(document.getElementById('tabJobs').classList.contains('active')) { loadJobs(); }
                    }
                    lastJobId = latestJob.jobId;
                }
            } catch(e) { console.log("Polling error", e); }
        }


        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const otpInput = document.getElementById('loginOtp');
            const otpField = document.getElementById('otpField');
            const btnLogin = document.getElementById('btnLogin');

            if (currentAuthRole === 'Admin' && email === 'admin@chakan.com') {
                if (otpField.classList.contains('hidden')) { otpField.classList.remove('hidden'); btnLogin.innerText = 'Verify OTP'; localStorage.setItem('temp_otp', '1234'); showOtpNotification(); return; }
                if (otpInput.value !== '1234') { alert('Invalid Admin OTP'); return; }
                loginSuccess({ uid: 'admin_default_001', name: 'Super Admin', email: 'admin@chakan.com', role: 'Admin', status: 'Active' });
                return;
            }

            if (otpField.classList.contains('hidden')) {
                otpField.classList.remove('hidden'); btnLogin.innerText = 'Sending OTP...';
                const mockOtp = Math.floor(1000 + Math.random() * 9000);
                try { fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'send_otp', payload: { email: email, otp: mockOtp } }) }); } catch(e) {}
                showOtpNotification(); localStorage.setItem('temp_otp', mockOtp); btnLogin.innerText = 'Verify OTP';
                return;
            }

            if (otpInput.value !== localStorage.getItem('temp_otp')) { alert('Invalid OTP'); return; }

            btnLogin.innerText = 'Verifying...';
            try {
                const response = await fetch(`${SCRIPT_URL}?action=login&email=${email}`);
                const result = await response.json();
                if (result.status === 'success' && result.data && result.data.role === currentAuthRole) { loginSuccess(result.data); } 
                else { alert('User not found or role mismatch. Please register.'); btnLogin.innerText = 'Login / Send OTP'; }
            } catch(error) { alert("Connection failed. Check console."); btnLogin.innerText = 'Login / Send OTP'; }
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const userData = { uid: 'user_' + Date.now(), name: document.getElementById('regName').value, email: document.getElementById('regEmail').value, mobile: document.getElementById('regMobile').value, role: currentAuthRole, status: currentAuthRole === 'Recruiter' ? 'Pending' : 'Active', age: document.getElementById('regAge').value, skills: document.getElementById('regSkills').value || '', qualification: document.getElementById('regQualification').value || '', location: document.getElementById('regLocation').value || '' };
            const btn = e.target.querySelector('button'); btn.innerText = 'Registering...';
            try {
                await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'register_user', payload: userData }) });
                if (currentAuthRole === 'Recruiter') { alert('Registration successful! Please wait for Admin approval.'); toggleRegistration(false); } else { loginSuccess(userData); }
            } catch(error) { alert("Registration failed. Check connection."); }
            btn.innerText = 'Register';
        });

        function loginSuccess(user) {
            if (user.status === 'Pending') { alert('Your account is pending Admin approval.'); return; }
            currentUser = user; localStorage.setItem('job_portal_user', JSON.stringify(user));
            toggleAuthOverlay(false); document.getElementById('userGreeting').innerText = `Hello, ${user.name} (${user.role})`;
            document.getElementById('navLogin').classList.add('hidden'); document.getElementById('navProfile').classList.remove('hidden'); document.getElementById('headerLogoutBtn').classList.remove('hidden');
            setupUIByRole(); loadData();
        }

        function handleLogout() { localStorage.removeItem('job_portal_user'); location.reload(); }

        function setupUIByRole() {
            const role = currentUser.role; const postBtn = document.getElementById('postJobBtn'); const navAdmin = document.getElementById('navAdmin');
            if (role === 'Recruiter') { postBtn.classList.remove('hidden'); document.getElementById('jobsTitle').innerText = 'My Posted Jobs'; }
            else if (role === 'Admin') { navAdmin.classList.remove('hidden'); postBtn.classList.remove('hidden'); document.getElementById('jobsTitle').innerText = 'All Jobs Management'; }
            else { document.getElementById('jobsTitle').innerText = 'Latest Active Jobs'; }
        }

        function loadData() { loadJobs(); loadProfile(); if (currentUser.role === 'Admin') loadAdminData(); if (currentUser.role !== 'Admin') loadApplications(); }

        function openPostJobModal() { document.getElementById('postJobForm').classList.remove('hidden'); document.getElementById('postJobStatus').classList.add('hidden'); document.getElementById('postJobModal').classList.add('open'); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }

        document.getElementById('postJobForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const jobData = Object.fromEntries(formData.entries());
            jobData.jobId = 'job_' + Date.now(); jobData.recruiterId = currentUser.uid; jobData.recruiterName = currentUser.name; jobData.postedAt = Date.now();
            jobData.status = (currentUser.role === 'Recruiter') ? 'Pending' : 'Active';

            const form = document.getElementById('postJobForm'); const statusDiv = document.getElementById('postJobStatus');
            form.classList.add('hidden'); statusDiv.classList.remove('hidden');
            statusDiv.innerHTML = `<div class="spinner spinner-lg mb-4"></div><p class="text-slate-600 font-semibold">Submitting Job Post...</p>`;

            try {
                await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'post_job', payload: jobData }) });
                statusDiv.innerHTML = `<div class="checkmark-wrapper"><svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg></div><p class="text-green-600 font-bold text-lg mb-2">Success!</p><p class="text-slate-600 px-4 text-sm">Your vacancy has been sent for admin approval.</p>`;
                setTimeout(() => { closeModal('postJobModal'); e.target.reset(); loadJobs(); }, 3000);
            } catch(e) { alert("Failed to post job"); form.classList.remove('hidden'); statusDiv.classList.add('hidden'); }
        });

        async function loadJobs() {
            const feed = document.getElementById('jobFeed'); feed.innerHTML = '<div class="spinner mx-auto col-span-full"></div>';
            try {
                const response = await fetch(`${SCRIPT_URL}?action=get_active_jobs`); const result = await response.json();
                if(result.status === 'success') { renderJobs(result.data); } else { feed.innerHTML = '<p class="text-center text-slate-500 col-span-full py-10">No active jobs found.</p>'; }
            } catch(e) { feed.innerHTML = '<p class="text-center text-red-500 col-span-full">Error loading jobs.</p>'; }
        }

        function renderJobs(jobs) {
            const feed = document.getElementById('jobFeed'); feed.innerHTML = '';
            
            if (jobs && jobs.length > 0) {
                 // Update Last Job ID for polling check
                 lastJobId = jobs[0].jobId;
            }

            if (!jobs || jobs.length === 0) { feed.innerHTML = '<p class="text-center text-slate-500 col-span-full py-10">No jobs found.</p>'; return; }
            if (currentUser && currentUser.role === 'Recruiter') { jobs = jobs.filter(j => j.recruiterId === currentUser.uid); }
            jobs.forEach(job => {
                const card = document.createElement('div');
                card.className = 'job-card p-5 flex flex-col justify-between';
                let actionBtn = '';
                if (currentUser && currentUser.role === 'Recruiter') { actionBtn = `<div class="mt-4 text-center text-xs font-bold uppercase tracking-wider ${job.status==='Active'?'text-green-600':'text-orange-500'} bg-slate-50 py-2 rounded-lg">Status: ${job.status || 'Active'}</div>`; }
                else { actionBtn = `<button id="btn-apply-${job.jobId}" onclick="window.checkLoginAndApply('${job.jobId}')" class="btn-primary mt-4 w-full text-sm">Apply Now</button>`; }
                
                let contactInfo = '';
                if (currentUser) {
                    contactInfo = `<p class="flex items-center text-slate-600 font-medium text-sm mt-2 pt-2 border-t border-slate-50"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>${job.contact || 'N/A'}</p>`;
                } else {
                    contactInfo = `<p class="text-xs text-orange-500 mt-3 font-semibold cursor-pointer hover:underline text-center" onclick="toggleAuthOverlay(true)">Login to view contact number</p>`;
                }

                card.innerHTML = `<div><div class="flex justify-between items-start mb-2"><h3 class="font-bold text-lg text-slate-900 leading-tight">${job.title}</h3></div><p class="text-sm font-semibold text-orange-600 mb-3">${job.company}</p><div class="space-y-1.5 text-sm text-slate-500"><p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>${job.location}</p><p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>₹${job.salaryFrom || 0} - ₹${job.salaryTo || 0}</p><p class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>${job.vacancies} Vacancies</p>${contactInfo}</div></div>${actionBtn}`;
                feed.appendChild(card);
            });
        }

        window.checkLoginAndApply = function(jobId) {
            if (!currentUser) { toggleAuthOverlay(true); } else { applyForJob(jobId); }
        };

        window.applyForJob = async function(jobId) {
            if (currentUser.role !== 'Candidate') return;
            const btn = document.getElementById(`btn-apply-${jobId}`);
            if(btn) { btn.innerText = "Applying..."; btn.disabled = true; btn.classList.add("opacity-50", "cursor-not-allowed"); }
            const appData = { appId: 'app_' + Date.now(), jobId: jobId, candidateId: currentUser.uid, candidateName: currentUser.name, appliedAt: Date.now(), status: 'Applied' };
            try { 
                await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'apply_job', payload: appData }) }); 
                alert('Application submitted successfully!'); 
                if(btn) { btn.innerText = "Applied"; btn.classList.remove("bg-orange-100", "text-orange-700"); btn.classList.add("bg-green-100", "text-green-700"); }
            } catch(e) { alert('Application failed.'); if(btn) { btn.innerText = "Apply Now"; btn.disabled = false; btn.classList.remove("opacity-50", "cursor-not-allowed"); } }
        };

        async function loadApplications() {
            if (!currentUser) return;
            const tbody = document.getElementById('applicationsTable');
            tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center"><div class="spinner mx-auto"></div></td></tr>';
            try {
                const response = await fetch(`${SCRIPT_URL}?action=get_applications&uid=${currentUser.uid}&role=${currentUser.role}`);
                const result = await response.json();
                tbody.innerHTML = '';
                if (result.status === 'success' && result.data.length > 0) {
                    result.data.forEach(app => {
                        const row = document.createElement('tr');
                        row.className = "border-b border-slate-50 hover:bg-slate-50 transition-colors";
                        if(currentUser.role === 'Candidate') {
                             row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-slate-900">${app.jobTitle || app.jobId}</td><td class="px-6 py-4 text-sm text-slate-500" colspan="3">N/A</td><td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700">${app.status}</span></td>`;
                        } else {
                             row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-slate-900">${app.jobTitle || app.jobId}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600 font-medium">${app.candidateName}</td><td class="px-6 py-4 whitespace-nowrap text-xs text-slate-500"><div class="flex items-center gap-1 mb-1"><span class="text-orange-500">📞</span> ${app.mobile}</div><div class="flex items-center gap-1"><span class="text-orange-500">✉️</span> ${app.email}</div></td><td class="px-6 py-4 text-sm text-gray-500 text-xs">
                                <div>📍 ${app.location}</div>
                                <div>🎓 ${app.qualification}</div>
                            </td><td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700">${app.status}</span></td>`;
                        }
                        tbody.appendChild(row);
                    });
                } else { tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-slate-400 font-medium">No applications found.</td></tr>'; }
            } catch(e) { tbody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-red-500 font-medium">Error loading applications.</td></tr>'; }
        }

        async function loadAdminData() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=get_admin_data`);
                const result = await response.json();
                if(result.status === 'success') {
                    document.getElementById('statActiveJobs').innerText = result.stats.activeJobs;
                    document.getElementById('statRecruiters').innerText = result.stats.recruiters;
                    const recList = document.getElementById('pendingRecruitersList'); recList.innerHTML = '';
                    if (result.pendingRecruiters && result.pendingRecruiters.length > 0) {
                        result.pendingRecruiters.forEach(user => {
                            const li = document.createElement('li'); li.className = 'p-4 flex justify-between items-center border-b border-slate-50 last:border-0';
                            li.innerHTML = `<div><p class="font-bold text-slate-800">${user.name}</p><p class="text-xs text-slate-500">Recruiter | ${user.email}</p></div><button onclick="approveRecruiter('${user.uid}')" class="px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-xs font-bold hover:bg-green-200 transition-colors">Approve</button>`;
                            recList.appendChild(li);
                        });
                    } else { recList.innerHTML = '<li class="p-6 text-center text-slate-400 text-sm">No pending recruiter approvals.</li>'; }
                    const jobList = document.getElementById('pendingJobsList'); jobList.innerHTML = '';
                    if (result.pendingJobs && result.pendingJobs.length > 0) {
                        result.pendingJobs.forEach(job => {
                            const li = document.createElement('li'); li.className = 'p-4 flex justify-between items-center border-b border-slate-50 last:border-0';
                            li.innerHTML = `<div><p class="font-bold text-slate-800">${job.title}</p><p class="text-xs text-slate-500">${job.company}</p></div><button onclick="approveJob('${job.jobId}')" class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold hover:bg-blue-200 transition-colors">Approve Job</button>`;
                            jobList.appendChild(li);
                        });
                    } else { jobList.innerHTML = '<li class="p-6 text-center text-slate-400 text-sm">No pending job approvals.</li>'; }
                }
            } catch(e) { console.log("Admin data error", e); }
        }

        async function approveRecruiter(uid) {
             try { await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'approve_recruiter', payload: {uid: uid} }) }); alert("Recruiter Approved"); loadAdminData(); } catch(e) { alert("Failed"); }
        }

        async function approveJob(jobId) {
             try { await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'approve_job', payload: {jobId: jobId} }) }); alert("Job Approved and Live!"); loadAdminData(); } catch(e) { alert("Failed"); }
        }

        async function loadProfile() {
            if(!currentUser) return;
            renderProfile(currentUser);
            try {
                const response = await fetch(`${SCRIPT_URL}?action=login&email=${currentUser.email}`);
                const result = await response.json();
                if (result.status === 'success') {
                    currentUser = result.data;
                    localStorage.setItem('job_portal_user', JSON.stringify(currentUser));
                    renderProfile(currentUser);
                }
            } catch(e) { console.log("Profile refresh failed, using cached data"); }
        }

        function renderProfile(user) {
            document.getElementById('profileInitials').innerText = user.name.charAt(0).toUpperCase();
            document.getElementById('profileName').innerText = user.name;
            document.getElementById('profileRole').innerText = user.role;
            document.getElementById('profileEmail').innerText = user.email;
            document.getElementById('profileMobile').innerText = user.mobile;
            document.getElementById('profileStatus').innerText = user.status;
            const statusEl = document.getElementById('profileStatus');
            statusEl.className = `px-2.5 py-0.5 rounded-full text-xs font-semibold ${user.status === 'Active' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`;
            if(user.role === 'Candidate') {
                document.getElementById('profileCandidateDetails').classList.remove('hidden');
                document.getElementById('profileSkills').innerText = user.skills || 'N/A';
                document.getElementById('profileQual').innerText = user.qualification || 'N/A';
                document.getElementById('profileLoc').innerText = user.location || 'N/A';
            } else { document.getElementById('profileCandidateDetails').classList.add('hidden'); }
        }

        function animateRefresh(btnId) {
            const btn = document.getElementById(btnId);
            btn.classList.add('rotate-anim');
            setTimeout(() => btn.classList.remove('rotate-anim'), 500);
        }

        function switchTab(tabId) {
            if (!currentUser && (tabId === 'tabApplications' || tabId === 'tabAdmin' || tabId === 'tabProfile')) { toggleAuthOverlay(true); return; }
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active')); document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
                el.querySelector('.icon-container').style.background = 'transparent';
                el.querySelector('.icon-container').style.color = '#64748b'; // slate-500
                el.querySelector('.icon-container').style.transform = 'translateY(0)';
                el.querySelector('.icon-container').style.boxShadow = 'none';
                el.querySelector('span').style.color = '#94a3b8'; // slate-400
            });

            const btn = Array.from(document.querySelectorAll('.nav-item')).find(b => b.getAttribute('onclick').includes(tabId));
            if(btn) {
                btn.classList.add('active');
            }
        }
    </script>
</body>
</html>